users:
  - user01
  - user02
  - user03
  - user04
  - user05
  - user06
  - user07
  - user08
  - user09
  - user10
grafana:
  ingress:
    enabled: true
    hosts:
      - uptime-dashboard.example.com
    tls:
      - secretName: openshift-operations-monitoring
        hosts:
          - uptime-dashboard.example.com
  persistence:
    enabled: false
    size: "1Gi"
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Prometheus
          type: prometheus
          url: "http://{{ .Release.name }}-prometheus-server"
          access: proxy
          isDefault: true
  sidecar:
    dashboards:
      enabled: true
      labelValue: dashboard
prometheus-blackbox-exporter:
  image:
    repository: quay.io/prometheus/blackbox-exporter
  pspEnabled: false
  config:
    modules:
      http:
        prober: http
        timeout: 5s
        http:
          valid_http_versions: ["HTTP/1.0", "HTTP/1.1", "HTTP/2.0"]
          valid_status_codes:
            - 200
          follow_redirects: true
          preferred_ip_protocol: "ip4"
          tls_config:
            insecure_skip_verify: true
prometheus:
  alertmanager:
    enabled: false
  kube-state-metrics:
    enabled: false
  prometheus-node-exporter:
    enabled: false
  prometheus-pushgateway:
    enabled: false
  rbac:
    create: false
  server:
    configMapOverrideName: "obsolete"
    global:
      scrape_interval: 5s
      scrape_timeout: 5s
      evaluation_interval: 1m
    persistentVolume:
      enabled: true
  serverFiles:
    prometheus.yml:
      scrape_configs:
        - job_name: prometheus
          static_configs:
          - targets:
            - localhost:9090
        - job_name: 'prometheus-blackbox-exporter'
          metrics_path: /probe
          params:
            module: [http]
          static_configs:
            - targets: |
              {{- range .Values.users }}
                - https://uptime-app-uptime-app-prod.apps.{{ . }}-ops-training.openshift.ch/
                - https://console.apps.{{ . }}-ops-training.openshift.ch/
              {{- end }}
          relabel_configs:
            - source_labels: [__address__]
              target_label: __param_target
            - source_labels: [__param_target]
              target_label: instance
            - target_label: __address__
              replacement: "{{ .Release.Name }}-prometheus-blackbox-exporter:9115"
